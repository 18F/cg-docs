---
menu:
  main:
    parent: advanced
title: Custom Domains
---

## Managed Service Method

Cloud.gov offers a managed service that allows you to forward a domain you control to a cloud.gov application using [AWS CloudFront](https://aws.amazon.com/cloudfront/). Traffic is encrypted using an SSL certificate generated by [Let's Encrypt](https://letsencrypt.org/). Note: this method does not add your domain as a Cloud Foundry domain; it simply forwards traffic from your domain to the cloud.gov URL that you specify. To add a custom Cloud Foundry domain, see [Manual Method]({{< relref "#manual-method" >}}).

1. Target the space your application is running in.

    ```bash
    $ cf target -o <org> -s <space>
    ```

1. Create a service instance.

    ```
    $ cf create-service cdn-route cdn-route my-cdn-route \
        -c '{"domain": "my.domain.gov", "origin": "my-app.apps.cloud.gov"}'

    Create in progress. Use 'cf services' or 'cf service my-cdn-route' to check operation status.
    ```

    If you have more than one domain you can pass a comma-delimited list to the `domain` parameter, just keep in mind that the broker will wait until all domains are CNAME'd:

    ```
    $ cf create-service cdn-route cdn-route my-cdn-route \
        -c '{"domain": "my.domain.gov,www.my.domain.gov", "origin": "my-app.apps.cloud.gov"}'

    Create in progress. Use 'cf services' or 'cf service my-cdn-route' to check operation status.
    ```

1. Get the DNS instructions.

    ```
    $ cf service my-cdn-route

    Last Operation
    Status: create in progress
    Message: Provisioning in progress; CNAME domain "my.domain.gov" to "d3kajwa62y9xrp.cloudfront.net."
    ```

1. Create/update your DNS configuration.
1. Wait up to 30 minutes for the CloudFront distribution to be provisioned and the DNS changes to propagate.
1. Visit `my.domain.gov`, and see that you have a valid certificate (i.e. that visiting your site in a modern browser doesn't give you a certificate warning).

## Manual Method

### Creating the [Load Balancer (ELB)](http://aws.amazon.com/elasticloadbalancing/)
There needs to be one ELB pointing to Cloud Foundry per TLS certificate.

** WARNING: Please [create a ticket](https://github.com/18f/devops/issues/new) in the DevOps repo with the name of every new ELB so it is added to BOSH. **

* If domains under the cert already point to apps on Cloud Foundry (e.g. `18f.us` or `18f.gov`), you're all set.
* If not, follow the [ELB instructions]({{< relref "ops/elb.md" >}}).

### Creating the [Hosted Zone](http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/AboutHZWorkingWith.html).

* If it already exists in [Route 53](https://console.aws.amazon.com/route53/home?region=us-east-1#hosted-zones:), you're good.
* If not, follow [these instructions](https://github.com/18F/https#set-up-the-domain).

### Creating the [Record Set](http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/rrsets-working-with.html).
1. Click on the Domain Name of the Hosted Zone.
1. Click "Create Record Set".
1. For `Alias`, select `Yes`.
1. For `Alias Target`, type the name of your ELB and select it from the list.
    * For `*.18f.us` domains, use `dualstack.cf-app-router-*`.

### Creating the Cloud Foundry Domain Association

Before you can create Cloud Foundry applications under your new domain you must associate the domain to an organization. There are two options for registration, private and shared.

#### Private / Shared Domain Association

**Private:**

Private registration enables a single organization to create routes for or under the specified domain. Organizations and private domains are a 1 to 1 relationship. A single domain cannot be privately registered to multiple organizations.

**Shared:**

Shared registrations enable **all** organizations to create routes under the shared domain.

#### Listing Domain Associations

To list all registrations for the currently targeted organization.

	$ cf domains

	Getting domains in org ORGANIZATION as USER...
	name           status
	cf.domain.tld  shared
	domain.tld     shared
	domain.com     owned

Private registrations appear with the status `owned` while shared registrations show just that, `shared`.

#### Private Domain Registration

To create a private registration.

	cf create-domain ORG DOMAIN

[API](http://apidocs.cloudfoundry.org/206/private_domains/create_a_private_domain_owned_by_the_given_organization.html)

#### Shared Domain Registration

To create a shared registration.

	cf create-shared-domain ORG DOMAIN

[API](http://apidocs.cloudfoundry.org/206/shared_domains/create_a_shared_domain.html)

#### Application Routes

Use your application manifest.yml to identify the domain where the application route should be created.

For example...

	---
	...
	- name: myapp
	  domain: domain.tld

Will create the route `myapp.domain.tld` for your application. Alternatively, you can specify a specific hostname for your app separate from the application name within CF.

	---
	...
	- name: myapp
	  host: frontend
	  domain: domain.tld

Will create the route `frontend.domain.tld` for your application.

##### Hostless Routes

One common scenario is the need to redirect a delegated subdomain to a CF app. In this case, you've been delegated `app.parent.tld` for your CF-hosted app from the owners of `parent.tld`.

Rather than create the `parent.tld` domain within CF we can create the full `app.parent.tld` domain and map it to an application.

	cf create-domain ORGANIZATION app.parent.tld
	cf map-route myapp app.parent.tld

[API](http://apidocs.cloudfoundry.org/206/routes/associate_app_with_the_route.html)

---

See also: [Official Cloud Foundry Documentation](https://docs.cloudfoundry.org/devguide/deploy-apps/routes-domains.html).
